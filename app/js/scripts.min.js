"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function renderChart(t,e,r){e.selectAll(".line, .bar, .y, .focus, g:not([class])").remove();var a=r.margin,n=r.width,o=r.height,i=r.tooltip,c=r.x,s=r.xAxis,l="First Line Data",d="Second Line Data",u=t["Arrows Data"].filter((function(t){return"direct"===t.type_of_rho})),p=t["Arrows Data"].filter((function(t){return"reverse"===t.type_of_rho})),h=d3.bisector((function(t){return t.date})).left;histogram(u,e,{x:c,prop:"direct",height:o,color:"#0F0"}),histogram(p,e,{x:c,prop:"reverse",height:o,color:"#F00"});var f=chart(t[l],e,{margin:a,width:n,height:o,x:c,xAxis:s,prop:l,color:"#00f",axis:"Left"}),x=chart(t[d],e,{margin:a,width:n,height:o,x:c,xAxis:s,prop:d,color:"#fdd023",axis:"Right"}),m=e.append("g").attr("class","focus").style("display","none");function g(){var t=event.target.closest(".line");if(t){var e=t.classList.contains("line--1")?x:f,r=e.data,a=e.x,n=e.y,o=e.color,i=e.prop;if(r){var c=a.invert(d3.mouse(this)[0]),s=h(r,c,1),l=r[s-1],d=r[s],u=c-l.date>d.date-c?d:l;m.select("circle").attr("fill",o),m.attr("transform","translate("+a(u.date)+","+n(u.value)+")"),m.select(".tooltip-name").text(i),m.select(".tooltip-date").text((function(){var t=u.date;return"".concat(["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"][t.getMonth()]," ").concat(t.getDate(),", ").concat(t.getFullYear())})),m.select(".tooltip-likes").text(u.value.toFixed(4))}}}m.append("circle").attr("r",5),m.append("rect").attr("class","tooltip").attr("width",i.width).attr("height",i.height).attr("x",10).attr("y",-22).attr("rx",4).attr("ry",4),m.append("text").attr("class","tooltip-name").attr("x",18).attr("y",-2),m.append("text").attr("class","tooltip-date-name").attr("x",18).attr("y",18).text("Date:"),m.append("text").attr("class","tooltip-date").attr("x",70).attr("y",18),m.append("text").attr("x",18).attr("y",38).text("Value:"),m.append("text").attr("class","tooltip-likes").attr("x",70).attr("y",38),e.on("mouseover",(function(){event.target.closest(".line")&&m.style("display",null)})).on("mouseout",(function(){m.style("display","none")})).on("mousemove",g).call((function(t){var e=[[a.left,a.top],[n-a.right,o-a.top]];t.on("mousemove",null).call(d3.zoom().scaleExtent([1,10]).translateExtent(e).extent(e).on("zoom",(function(){c.range([0,n].map((function(t){return d3.event.transform.applyX(t)}))),console.log(d3.event.transform),t.selectAll(".x.axis").call(s.ticks(Math.round(10*d3.event.transform.k))),t.selectAll(".line").each((function(t,e){var r=d3.select(this),a=r.classed("line--0")?f:x;r.datum(a.data).attr("d",a.line)})),t.selectAll(".bar").remove(),histogram(u,t,{x:c,prop:"direct",height:o,color:"#0F0"}),histogram(p,t,{x:c,prop:"reverse",height:o,color:"#F00"})}))).on("mousemove",g)}))}function chart(t,e,r){var a=r.margin,n=r.width,o=r.height,i=r.x,c=r.xAxis,s=r.prop,l=r.color,d=void 0===l?"#ccc":l,u=r.axis,p=void 0===u?"Left":u;if(this.counter||(this.counter=0),!t)return{counter:this.counter++};var h="Left"===p,f=h?"Right":"Left",x=h?0:-105,m=h?0:n-1,g=d3.scaleLinear().range([o,0]),y=d3["".concat("axis").concat(f)](g),v=d3.line().x((function(t){return i(t.date)})).y((function(t){return g(t.value)}));return e.attr("width",n+a.left+a.right).attr("height",o+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")"),t.forEach((function(t){t.date=new Date(t.date),t.value=+t.value})),g.domain(d3.extent(t,(function(t){return t.value}))),e.append("g").attr("class","y axis").attr("transform","translate(".concat(m,", 0)")).call(y).append("text").attr("transform","rotate(-90) translate(0, ".concat(x,")")).attr("y",45).attr("dy",".71em").style("text-anchor","end").text(s).attr("stroke",d),e.append("path").datum(t).attr("class","line line--".concat(this.counter)).attr("d",v).attr("stroke",d).select((function(){return this.previousElementSibling})).select("path.domain").attr("stroke",d),{x:i,xAxis:c,y:g,yAxis:y,line:v,data:t,prop:s,color:d,counter:this.counter++}}function histogram(t,e,r){var a=r.x,n=r.prop,o=r.height,i=r.color,c=void 0===i?"#5D6971":i;e.selectAll(".bar--".concat(n)).data(t).enter().insert("rect",".x.axis").attr("class","bar bar--".concat(n)).attr("fill",c).attr("x",(function(t){return a(new Date(t.min_period_id))})).attr("width",(function(t){return a(new Date(t.max_period_id))-a(new Date(t.min_period_id))})).attr("y",(function(t){return 0})).attr("height",(function(t){return o}))}function proceedData(t){if(this.counter=0,"object"!==_typeof(t))return t;var e="Arrows Data",r=document.forms[0],a={};Array.prototype.forEach.call(r.elements,(function(t){a[t.name]=t.checked}));var n=Object.assign({},t),o=[];return a["First Line Data"]||delete n["First Line Data"],a["Second Line Data"]||delete n["Second Line Data"],e in t&&(o=t[e].filter((function(t){switch(t.type_of_rho){case"direct":return!!a.direct;case"reverse":return!!a.reverse;default:return!0}}))),n[e]=o,n}window.addEventListener("load",(function(){var t=d3.select("svg"),e={top:0,right:0,bottom:0,left:0},r=+t.attr("width")-e.left-e.right,a=+t.attr("height")-e.top-e.bottom,n={width:180,height:72,x:10,y:-30};$.ajax({url:"./files/data.json",method:"get",success:function(o){var i=o["First Line Data"].map((function(t){return new Date(t.date)})),c=d3.scaleTime().range([0,r]),s=d3.axisBottom(c).ticks();c.domain(d3.extent(i,(function(t){return t}))),t.append("g").attr("class","x axis").attr("transform","translate(0,"+a+")").call(s),renderChart(o,t,{margin:e,width:r,height:a,tooltip:n,x:c,xAxis:s}),document.forms[0].addEventListener("change",(function(){renderChart(proceedData(o),t,{margin:e,width:r,height:a,tooltip:n,x:c,xAxis:s})}))},error:function(t){throw Error(t)}})}));